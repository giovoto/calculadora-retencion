<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Retención - Colombia 2025</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: "Inter", sans-serif;
      background: linear-gradient(135deg, #f0f2f5, #dbe2ef);
      padding: 40px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .flex-container {
      display: flex;
      gap: 30px;
      justify-content: center;
      align-items: flex-start;
      flex-wrap: wrap;
      max-width: 900px;
      width: 100%;
    }
    .container {
      background-color: #ffffff;
      border-radius: 12px;
      padding: 30px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 25px;
      color: #333;
    }
    label {
      font-weight: 600;
      margin-top: 15px;
      display: block;
      color: #444;
    }
    select,
    input[type="number"],
    input[type="checkbox"] {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
    }
    .checkbox-label {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }
    .checkbox-label input {
      width: auto;
      margin-right: 10px;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 12px;
      font-size: 16px;
      width: 100%;
      border-radius: 8px;
      margin-top: 25px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0056b3;
    }
    #resultado {
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border-left: 6px solid #007bff;
      min-width: 320px;
      max-width: 350px;
      margin-top: 0;
      height: fit-content;
    }
    #resultado p {
      margin: 8px 0;
      font-size: 15px;
      color: #333;
      word-wrap: break-word;
    }
    #ciiu-group {
      display: none;
    }
    .resultado-columna {
      flex: 1;
      margin-left: 20px;
      background-color: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border-left: 6px solid #007bff;
      min-width: 320px;
      max-width: 350px;
      margin-top: 0;
      height: fit-content;
    }
    .total-destacado {
      font-size: 20px;
      font-weight: bold;
      color: #007bff;
      margin-top: 18px;
    }
    @media (max-width: 900px) {
      .flex-container {
        flex-direction: column;
        align-items: stretch;
      }
      .resultado-columna {
        margin-top: 25px;
        max-width: 100%;
        min-width: 0;
        margin-left: 0;
      }
    }
  </style>
</head>
<body>
  <div class="flex-container">
    <div class="container">
      <h2>Calculadora de Retención 2025</h2>
      <form id="calc-form">
        <label for="regimen">Tipo de régimen:</label>
        <select id="regimen" required>
          <option value="no_declarante">No declarante</option>
          <option value="responsable_iva">Responsable de IVA</option>
          <option value="gran_contribuyente">Gran contribuyente</option>
          <option value="gran_autoretenedor">Gran contribuyente autoretenedor</option>
        </select>

        <label for="operacion">Tipo de operación:</label>
        <select id="operacion" required>
          <option value="honorarios">Honorarios</option>
          <option value="servicios">Servicios</option>
          <option value="arrendamientos">Arrendamientos</option>
          <option value="compras">Compras</option>
        </select>

        <label for="persona">Tipo de persona:</label>
        <select id="persona" required>
          <option value="natural">Persona Natural</option>
          <option value="juridica">Persona Jurídica</option>
        </select>

        <label for="valor">Valor de la operación (sin IVA):</label>
        <input type="number" id="valor" min="0" step="0.01" required />

        <div class="checkbox-label">
          <input type="checkbox" id="aplicaIVA" />
          <label for="aplicaIVA">¿Aplica IVA?</label>
        </div>

        <div class="checkbox-label">
          <input type="checkbox" id="esBogota" />
          <label for="esBogota">¿La operación se realiza en Bogotá?</label>
        </div>

        <div id="ciiu-group">
          <label for="ciiu">Actividad económica (CIIU):</label>
          <select id="ciiu">
            <option value="1011">1011 - Producción de carne</option>
            <option value="1020">1020 - Producción láctea</option>
            <option value="1511">1511 - Confección prendas de vestir</option>
            <option value="2410">2410 - Fabricación hierro, acero y material transporte</option>
            <option value="5811">5811 - Actividades editoriales (libros)</option>
            <option value="4711">
              4711 - Comercio al por menor (alimentos y medicinas)
            </option>
            <option value="4721">4721 - Venta productos agrícolas en bruto</option>
            <option value="4641">4641 - Venta de maderas y materiales construcción</option>
            <option value="4511">4511 - Comercio de vehículos</option>
            <option value="4631">4631 - Venta cigarrillos y licores</option>
            <option value="4722">4722 - Venta de combustibles</option>
            <option value="4643">4643 - Venta de joyas</option>
            <option value="4690">4690 - Otros comercios</option>
            <option value="4930">4930 - Transporte terrestre</option>
            <option value="6010">6010 - Transporte aéreo</option>
            <option value="6020">6020 - Transporte marítimo</option>
            <option value="6201">6201 - Desarrollo de software a medida</option>
            <option value="6202">6202 - Consultoría informática</option>
            <option value="7110">7110 - Servicios técnicos y profesionales</option>
            <option value="5611">5611 - Restaurantes y comidas</option>
            <option value="5510">5510 - Hoteles y alojamientos</option>
            <option value="8010">8010 - Servicios de vigilancia</option>
            <option value="8541">8541 - Educación privada</option>
            <option value="6820">6820 - Actividades inmobiliarias</option>
            <option value="9602">9602 - Peluquería y otros servicios personales</option>
            <option value="6419">6419 - Servicios financieros</option>
          </select>
        </div>

        <button type="submit">Calcular</button>
        <button
          type="button"
          id="btn-limpiar"
          style="margin-top: 10px; background-color: #6c757d"
        >
          Limpiar
        </button>
      </form>
    </div>
    <div id="resultado" class="resultado-columna" style="display: none"></div>
  </div>

  <script>
    const tarifasICABogota = {
      // A. Actividades Industriales (Tarifa por mil)
      alimentos: 0.00414,
      hierro_acero_transporte: 0.0069,
      libros: 0.008,
      industrial_otros: 0.01104,

      // B. Actividades Comerciales (Tarifa por mil)
      alimentos_agricolas_libros_medicamentos: 0.00414,
      maderas_automotores_contables: 0.0069,
      cigarrillos_licores_combustibles_joyas: 0.0138,
      comercial_otros: 0.01104,

      // C. Actividades de servicios (Tarifa por mil)
      transporte_publicacion_radio_tv: 0.00414,
      consultoria_construccion_cine: 0.0069,
      restaurante_hotel_vigilancia: 0.0138,
      educacion_privada: 0.007,
      servicios_otros: 0.00966,

      // D. Actividades financieras (Tarifa por mil)
      financieras: 0.01104,
    };

    const ciiuCategoria = {
      // Industriales
      "1011": "alimentos",
      "1020": "alimentos",
      "1511": "industrial_otros",
      "2410": "hierro_acero_transporte",
      "5811": "libros",

      // Comerciales
      "4711": "alimentos_agricolas_libros_medicamentos",
      "4721": "alimentos_agricolas_libros_medicamentos",
      "4641": "maderas_automotores_contables",
      "4511": "maderas_automotores_contables",
      "4631": "cigarrillos_licores_combustibles_joyas",
      "4722": "cigarrillos_licores_combustibles_joyas",
      "4643": "cigarrillos_licores_combustibles_joyas",
      "4690": "comercial_otros",

      // Servicios
      "4930": "transporte_publicacion_radio_tv",
      "6010": "transporte_publicacion_radio_tv",
      "6020": "transporte_publicacion_radio_tv",
      "6201": "consultoria_construccion_cine",
      "6202": "consultoria_construccion_cine",
      "7110": "consultoria_construccion_cine",
      "5611": "restaurante_hotel_vigilancia",
      "5510": "restaurante_hotel_vigilancia",
      "8010": "restaurante_hotel_vigilancia",
      "8541": "educacion_privada",
      "6820": "servicios_otros",
      "9602": "servicios_otros",

      // Financieras
      "6419": "financieras",
    };

    document.getElementById("esBogota").addEventListener("change", function () {
      const group = document.getElementById("ciiu-group");
      group.style.display = this.checked ? "block" : "none";
    });

    document.getElementById("calc-form").addEventListener("submit", function (e) {
      e.preventDefault();

      const regimen = document.getElementById("regimen").value;
      const operacion = document.getElementById("operacion").value;
      const persona = document.getElementById("persona").value;
      const valor = parseFloat(document.getElementById("valor").value);
      const aplicaIVA = document.getElementById("aplicaIVA").checked;
      const esBogota = document.getElementById("esBogota").checked;
      const ciiu = document.getElementById("ciiu").value;

      if (isNaN(valor) || valor < 0) {
        alert("Por favor ingresa un valor válido para la operación.");
        return;
      }

      const esDeclarante = regimen === "responsable_iva" || regimen.includes("gran");

      let porcentajeRetencion = 0;
      let baseMinima = 0;
      const porcentajeIVA = 0.19;

      if (operacion === "honorarios") {
        porcentajeRetencion = persona === "juridica" ? 0.11 : esDeclarante ? 0.11 : 0.10;
        baseMinima = 0;
      } else if (operacion === "servicios") {
        porcentajeRetencion = esDeclarante ? 0.04 : 0.06;
        baseMinima = 100000;
      } else if (operacion === "arrendamientos") {
        porcentajeRetencion = 0.035;
        baseMinima = 498000;
      } else if (operacion === "compras") {
        porcentajeRetencion = esDeclarante ? 0.025 : 0.035;
        baseMinima = 498000;
      }

      const iva = aplicaIVA ? valor * porcentajeIVA : 0;
      const retencion = valor >= baseMinima ? valor * porcentajeRetencion : 0;

      // Calcula tarifa ICA: si es Bogotá, busca tarifa, si no la encuentra usa "comercial_otros" por defecto
      const porcentajeICA = esBogota
        ? tarifasICABogota[ciiuCategoria[ciiu]] ?? tarifasICABogota["comercial_otros"]
        : 0;

      const ica = valor * porcentajeICA;
      const totalRetenido = retencion + ica;
      const totalPagar = valor + iva - totalRetenido;

      const resultado = document.getElementById("resultado");
      resultado.style.display = "block";
      resultado.innerHTML = `
        <p><strong>Valor base:</strong> ${valor.toLocaleString("es-CO", {
          style: "currency",
          currency: "COP",
        })}</p>
        <p><strong>IVA (${(porcentajeIVA * 100).toFixed(0)}%):</strong> ${iva.toLocaleString(
          "es-CO",
          { style: "currency", currency: "COP" }
        )}</p>
        <p><strong>Base mínima para retención:</strong> ${baseMinima.toLocaleString(
          "es-CO",
          { style: "currency", currency: "COP" }
        )}</p>
        <p><strong>Retención en la fuente (${(porcentajeRetencion * 100).toFixed(
          1
        )}%):</strong> ${retencion.toLocaleString("es-CO", {
        style: "currency",
        currency: "COP",
      })}</p>
        <p><strong>Tarifa ICA Bogotá:</strong> ${(porcentajeICA * 1000).toFixed(
          2
        )} por mil</p>
        <p><strong>Valor ICA:</strong> ${ica.toLocaleString("es-CO", {
          style: "currency",
          currency: "COP",
        })} ${esBogota ? "" : "(No aplica fuera de Bogotá)"}</p>
        <p class="total-destacado">Total retenido: ${totalRetenido.toLocaleString(
          "es-CO",
          { style: "currency", currency: "COP" }
        )}</p>
        <p class="total-destacado">Total a pagar: ${totalPagar.toLocaleString("es-CO", {
          style: "currency",
          currency: "COP",
        })}</p>
      `;
    });

    document.getElementById("btn-limpiar").addEventListener("click", function () {
      document.getElementById("calc-form").reset();
      document.getElementById("resultado").style.display = "none";
      document.getElementById("ciiu-group").style.display = "none";
    });
  </script>
</body>
</html>
